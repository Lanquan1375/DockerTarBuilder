name: Build Scrutiny Offline Images

on:
  workflow_dispatch: # 仅手动触发

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：拉取 Scrutiny Web 镜像
      - name: Pull Scrutiny Web Image
        run: |
          docker pull ghcr.io/analogj/scrutiny:master-web --platform linux/amd64

      # 步骤2：拉取 Scrutiny Collector 镜像
      - name: Pull Scrutiny Collector Image
        run: |
          docker pull ghcr.io/analogj/scrutiny:master-collector --platform linux/amd64

      # 步骤3：将两个镜像分别打包并压缩
      - name: Save and Compress Images
        run: |
          docker save ghcr.io/analogj/scrutiny:master-web -o scrutiny-web.tar
          docker save ghcr.io/analogj/scrutiny:master-collector -o scrutiny-collector.tar
          gzip scrutiny-web.tar
          gzip scrutiny-collector.tar

      # 步骤4：将打包好的文件上传，供您下载
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: scrutiny-offline-images
          path: |
            *.tar.gz
